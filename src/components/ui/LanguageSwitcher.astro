---
import { getLocale, setLocale, locales } from '../../paraglide/runtime';

const currentLocale = getLocale();
const localeNames = { en: 'English', es: 'Español' };
---

<div class="relative">
  <button 
    id="lang-toggle"
    type="button"
    class="grid grid-cols-[auto_auto] items-center gap-1 rounded-full px-4 py-2 text-left text-sm/6 text-gray-700 border border-gray-700 lg:hover:bg-gray-700 lg:hover:text-white transition-colors duration-150"
  >
    <span class="font-medium">{currentLocale.toUpperCase()}</span>
    <svg class="w-4 h-4 transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
    </svg>
  </button>

  <div 
    id="lang-dropdown"
    class="absolute right-0 mt-2 w-48 rounded-xl border border-gray-200 bg-white shadow-lg py-2 z-50 hidden"
  >
    {locales.map((lang) => {
      const isCurrent = currentLocale === lang;
      
      return (
        <button
          type="button"
          data-lang={lang}
          class={`lang-option flex items-center justify-between w-full px-4 py-3 transition-colors duration-150 text-left ${isCurrent ? 'bg-blue-50/80 text-blue-500 font-medium' : 'hover:bg-blue-50'}`}
        >
          <div class="flex items-center gap-3">
            <div>
              <div class="font-medium">{localeNames[lang]}</div>
              <div class="text-xs font-mono text-gray-500">{lang.toUpperCase()}</div>
            </div>
          </div>
          {isCurrent && (
            <svg class="w-5 h-5 text-blue-600" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
            </svg>
          )}
        </button>
      );
    })}
  </div>
</div>

<script>
  import { getLocale, setLocale, locales } from '../../paraglide/runtime';
  document.addEventListener('DOMContentLoaded', () => {
    const toggle = document.getElementById('lang-toggle');
    const dropdown = document.getElementById('lang-dropdown');
    
    if (!toggle || !dropdown) return;
    
    
    toggle.addEventListener('click', (e) => {
      e.stopPropagation();
      const isHidden = dropdown.classList.contains('hidden');
      dropdown.classList.toggle('hidden', !isHidden);
      toggle.querySelector('svg').style.transform = isHidden ? 'rotate(180deg)' : 'rotate(0deg)';
    });
    
    
    document.addEventListener('click', () => {
      dropdown.classList.add('hidden');
      toggle.querySelector('svg').style.transform = 'rotate(0deg)';
    });
    
    dropdown.addEventListener('click', (e) => {
      e.stopPropagation();
    });
    
    
    document.querySelectorAll('.lang-option').forEach(button => {
      button.addEventListener('click', function() {
        const lang = this.dataset.lang;
        const currentLang = '${currentLocale}';
        
        if (lang !== currentLang) {
          
          if (typeof setLocale === 'function') {
            setLocale(lang, { reload: false });
          } else {
            console.error('setLocale no está definida');
          }
          
          
          dropdown.classList.add('hidden');
          toggle.querySelector('svg').style.transform = 'rotate(0deg)';
          
          
          setTimeout(() => window.location.reload(), 50);
        }
      });
    });
  });
</script>